# Rate Limiting Configuration for nginx
#
# This file defines rate limit zones that protect the application
# from abuse and DoS attacks at the nginx level (before reaching the backend).
#
# These are coarse-grained limits. Fine-grained rate limiting is handled
# by the Strapi middleware.

# General rate limit zone
# Limits general traffic to 10 requests per second per IP
limit_req_zone $binary_remote_addr zone=general:10m rate=10r/s;

# Login rate limit zone
# Very strict: 2 requests per minute per IP
# This prevents brute force attacks on the login endpoint
limit_req_zone $binary_remote_addr zone=login:10m rate=2r/m;

# API rate limit zone
# Moderate: 100 requests per minute per IP
# This protects the API from excessive requests
limit_req_zone $binary_remote_addr zone=api:10m rate=100r/m;

# Upload rate limit zone
# Conservative: 10 requests per minute per IP
# File uploads are resource-intensive
limit_req_zone $binary_remote_addr zone=upload:10m rate=10r/m;

# Admin rate limit zone
# Generous for authenticated admin users
limit_req_zone $binary_remote_addr zone=admin:10m rate=50r/m;

# Monitoring rate limit zone
# Very generous for health checks and metrics
limit_req_zone $binary_remote_addr zone=monitoring:10m rate=10r/s;

# Status code to return when rate limit is exceeded
# This can be used in location blocks
limit_req_status 429;
